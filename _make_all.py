import os, json

BASE = os.path.dirname(os.path.abspath(__file__))

def w(p, c):
    fp = os.path.join(BASE, p)
    os.makedirs(os.path.dirname(fp), exist_ok=True)
    with open(fp, 'w') as fh:
        fh.write(c)

print('Script running from', BASE)

import base64
iwarp_code = base64.b64decode("IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKSW50ZWwgaVdhcnAgR3JleS1Cb3ggUXVldWVpbmcgTW9kZWwKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClRhcmdldCBDUEk6IDEuNSAoVkxJVyBkdWFsLWlzc3VlLCAxOTg1KQpBcmNoaXRlY3R1cmU6IFZMSVcvc3lzdG9saWMgYXJyYXksIDIwTUh6LCAzMi1iaXQKIiIiCgpmcm9tIGRhdGFjbGFzc2VzIGltcG9ydCBkYXRhY2xhc3MKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QKCkBkYXRhY2xhc3MKY2xhc3MgSW5zdHJ1Y3Rpb25DYXRlZ29yeToKICAgIG5hbWU6IHN0cgogICAgYmFzZV9jeWNsZXM6IGZsb2F0CiAgICBtZW1vcnlfY3ljbGVzOiBmbG9hdCA9IDAKICAgIGRlc2NyaXB0aW9uOiBzdHIgPSAiIgogICAgQHByb3BlcnR5CiAgICBkZWYgdG90YWxfY3ljbGVzKHNlbGYpOiByZXR1cm4gc2VsZi5iYXNlX2N5Y2xlcyArIHNlbGYubWVtb3J5X2N5Y2xlcwoKQGRhdGFjbGFzcwpjbGFzcyBXb3JrbG9hZFByb2ZpbGU6CiAgICBuYW1lOiBzdHIKICAgIGNhdGVnb3J5X3dlaWdodHM6IERpY3Rbc3RyLCBmbG9hdF0KICAgIGRlc2NyaXB0aW9uOiBzdHIgPSAiIgoKQGRhdGFjbGFzcwpjbGFzcyBBbmFseXNpc1Jlc3VsdDoKICAgIHByb2Nlc3Nvcjogc3RyCiAgICB3b3JrbG9hZDogc3RyCiAgICBpcGM6IGZsb2F0CiAgICBjcGk6IGZsb2F0CiAgICBpcHM6IGZsb2F0CiAgICBib3R0bGVuZWNrOiBzdHIKICAgIHV0aWxpemF0aW9uczogRGljdFtzdHIsIGZsb2F0XQogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZnJvbV9jcGkoY2xzLCBwcm9jZXNzb3IsIHdvcmtsb2FkLCBjcGksIGNsb2NrX21oeiwgYm90dGxlbmVjaywgdXRpbGl6YXRpb25zKToKICAgICAgICBpcGMgPSAxLjAgLyBjcGkKICAgICAgICBpcHMgPSBjbG9ja19taHogKiAxZTYgKiBpcGMKICAgICAgICByZXR1cm4gY2xzKHByb2Nlc3Nvciwgd29ya2xvYWQsIGlwYywgY3BpLCBpcHMsIGJvdHRsZW5lY2ssIHV0aWxpemF0aW9ucykKCmNsYXNzIEJhc2VQcm9jZXNzb3JNb2RlbDogcGFzcwoKCmNsYXNzIElXYXJwTW9kZWwoQmFzZVByb2Nlc3Nvck1vZGVsKToKICAgIG5hbWUgPSAiSW50ZWwgaVdhcnAiCiAgICBtYW51ZmFjdHVyZXIgPSAiSW50ZWwvQ01VIgogICAgeWVhciA9IDE5ODUKICAgIGNsb2NrX21oeiA9IDIwLjAKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi52bGl3X3dpZHRoID0gMgogICAgICAgIHNlbGYuZHVhbF9pc3N1ZV9lZmZpY2llbmN5ID0gMC42OAogICAgICAgIHNlbGYuc3JhbV9oaXRfcmF0ZSA9IDAuODUKICAgICAgICBzZWxmLmV4dGVybmFsX21lbV9jeWNsZXMgPSA4CiAgICAgICAgc2VsZi5icmFuY2hfcGVuYWx0eSA9IDMKICAgICAgICBzZWxmLmNvbW1fb3ZlcmhlYWQgPSAyCgogICAgICAgIHNlbGYuaW5zdHJ1Y3Rpb25fY2F0ZWdvcmllcyA9IHsKICAgICAgICAgICAgImFsdV9pbnQiOiBJbnN0cnVjdGlvbkNhdGVnb3J5KCJhbHVfaW50IiwgMSwgMCwgIkludGVnZXIgQUxVIiksCiAgICAgICAgICAgICJtdWx0aXBseSI6IEluc3RydWN0aW9uQ2F0ZWdvcnkoIm11bHRpcGx5IiwgMywgMCwgIkludGVnZXIgbXVsdGlwbHkiKSwKICAgICAgICAgICAgImZwX2FkZCI6IEluc3RydWN0aW9uQ2F0ZWdvcnkoImZwX2FkZCIsIDIsIDAsICJGUCBhZGRpdGlvbiIpLAogICAgICAgICAgICAiZnBfbXVsIjogSW5zdHJ1Y3Rpb25DYXRlZ29yeSgiZnBfbXVsIiwgMywgMCwgIkZQIG11bHRpcGx5IiksCiAgICAgICAgICAgICJsb2FkX3N0b3JlIjogSW5zdHJ1Y3Rpb25DYXRlZ29yeSgibG9hZF9zdG9yZSIsIDEsIDAsICJMb2FkL3N0b3JlIFNSQU0iKSwKICAgICAgICAgICAgImJyYW5jaCI6IEluc3RydWN0aW9uQ2F0ZWdvcnkoImJyYW5jaCIsIDEsIDAsICJCcmFuY2gvanVtcCIpLAogICAgICAgICAgICAiY29tbSI6IEluc3RydWN0aW9uQ2F0ZWdvcnkoImNvbW0iLCAyLCAwLCAiU3lzdG9saWMgY29tbXVuaWNhdGlvbiIpLAogICAgICAgIH0KCiAgICAgICAgc2VsZi53b3JrbG9hZF9wcm9maWxlcyA9IHsKICAgICAgICAgICAgInR5cGljYWwiOiBXb3JrbG9hZFByb2ZpbGUoInR5cGljYWwiLCB7CiAgICAgICAgICAgICAgICAiYWx1X2ludCI6IDAuMjUsICJtdWx0aXBseSI6IDAuMDUsICJmcF9hZGQiOiAwLjE1LAogICAgICAgICAgICAgICAgImZwX211bCI6IDAuMTAsICJsb2FkX3N0b3JlIjogMC4yNSwgImJyYW5jaCI6IDAuMTAsICJjb21tIjogMC4xMCwKICAgICAgICAgICAgfSksCiAgICAgICAgICAgICJjb21wdXRlIjogV29ya2xvYWRQcm9maWxlKCJjb21wdXRlIiwgewogICAgICAgICAgICAgICAgImFsdV9pbnQiOiAwLjE1LCAibXVsdGlwbHkiOiAwLjEwLCAiZnBfYWRkIjogMC4yNSwKICAgICAgICAgICAgICAgICJmcF9tdWwiOiAwLjI1LCAibG9hZF9zdG9yZSI6IDAuMTAsICJicmFuY2giOiAwLjA1LCAiY29tbSI6IDAuMTAsCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAibWVtb3J5IjogV29ya2xvYWRQcm9maWxlKCJtZW1vcnkiLCB7CiAgICAgICAgICAgICAgICAiYWx1X2ludCI6IDAuMTUsICJtdWx0aXBseSI6IDAuMDIsICJmcF9hZGQiOiAwLjA1LAogICAgICAgICAgICAgICAgImZwX211bCI6IDAuMDMsICJsb2FkX3N0b3JlIjogMC40NSwgImJyYW5jaCI6IDAuMTAsICJjb21tIjogMC4yMCwKICAgICAgICAgICAgfSksCiAgICAgICAgICAgICJjb250cm9sIjogV29ya2xvYWRQcm9maWxlKCJjb250cm9sIiwgewogICAgICAgICAgICAgICAgImFsdV9pbnQiOiAwLjMwLCAibXVsdGlwbHkiOiAwLjAzLCAiZnBfYWRkIjogMC4wNSwKICAgICAgICAgICAgICAgICJmcF9tdWwiOiAwLjAyLCAibG9hZF9zdG9yZSI6IDAuMjUsICJicmFuY2giOiAwLjI1LCAiY29tbSI6IDAuMTAsCiAgICAgICAgICAgIH0pLAogICAgICAgIH0KCiAgICBkZWYgYW5hbHl6ZShzZWxmLCB3b3JrbG9hZF9uYW1lPSJ0eXBpY2FsIik6CiAgICAgICAgaWYgd29ya2xvYWRfbmFtZSBub3QgaW4gc2VsZi53b3JrbG9hZF9wcm9maWxlczoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIlVua25vd24gd29ya2xvYWQ6IHt3b3JrbG9hZF9uYW1lfSIpCiAgICAgICAgcHJvZmlsZSA9IHNlbGYud29ya2xvYWRfcHJvZmlsZXNbd29ya2xvYWRfbmFtZV0KCiAgICAgICAgYmFzZV9jcGkgPSBzdW0odyAqIHNlbGYuaW5zdHJ1Y3Rpb25fY2F0ZWdvcmllc1tjXS50b3RhbF9jeWNsZXMKICAgICAgICAgICAgICAgICAgICAgICBmb3IgYywgdyBpbiBwcm9maWxlLmNhdGVnb3J5X3dlaWdodHMuaXRlbXMoKSkKCiAgICAgICAgZWZmX3dpZHRoID0gMS4wICsgc2VsZi5kdWFsX2lzc3VlX2VmZmljaWVuY3kKICAgICAgICBjcGkgPSBiYXNlX2NwaSAvIGVmZl93aWR0aAoKICAgICAgICBtZW1fdyA9IHByb2ZpbGUuY2F0ZWdvcnlfd2VpZ2h0cy5nZXQoImxvYWRfc3RvcmUiLCAwKQogICAgICAgIGNwaSArPSBtZW1fdyAqICgxLjAgLSBzZWxmLnNyYW1faGl0X3JhdGUpICogc2VsZi5leHRlcm5hbF9tZW1fY3ljbGVzCgogICAgICAgIGJyX3cgPSBwcm9maWxlLmNhdGVnb3J5X3dlaWdodHMuZ2V0KCJicmFuY2giLCAwKQogICAgICAgIGNwaSArPSBicl93ICogMC41ICogc2VsZi5icmFuY2hfcGVuYWx0eQoKICAgICAgICBjb21tX3cgPSBwcm9maWxlLmNhdGVnb3J5X3dlaWdodHMuZ2V0KCJjb21tIiwgMCkKICAgICAgICBjcGkgKz0gY29tbV93ICogMC4zICogc2VsZi5jb21tX292ZXJoZWFkCgogICAgICAgIGNvbXB1dGVfdyA9IHN1bShwcm9maWxlLmNhdGVnb3J5X3dlaWdodHMuZ2V0KGMsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjIGluIFsiYWx1X2ludCIsICJtdWx0aXBseSIsICJmcF9hZGQiLCAiZnBfbXVsIl0pCiAgICAgICAgdXRpbHMgPSB7CiAgICAgICAgICAgICJjb21wdXRlX3VuaXQiOiBtaW4oMC45NSwgY29tcHV0ZV93ICogMS4xKSwKICAgICAgICAgICAgIm1lbW9yeV9zdWJzeXN0ZW0iOiBtaW4oMC45NSwgbWVtX3cgKiAxLjIpLAogICAgICAgICAgICAiY29tbV9uZXR3b3JrIjogbWluKDAuOTUsIGNvbW1fdyAqIDEuNSksCiAgICAgICAgfQogICAgICAgIG1heF91ID0gbWF4KHV0aWxzLnZhbHVlcygpKQogICAgICAgIGlmIG1heF91ID4gMC41OgogICAgICAgICAgICBjcGkgKj0gMS4wIC8gKDEuMCAtIG1heF91ICogMC4zKQoKICAgICAgICBib3R0bGVuZWNrID0gbWF4KHV0aWxzLCBrZXk9dXRpbHMuZ2V0KQogICAgICAgIHJldHVybiBBbmFseXNpc1Jlc3VsdC5mcm9tX2NwaShzZWxmLm5hbWUsIHdvcmtsb2FkX25hbWUsIHJvdW5kKGNwaSwgNCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNsb2NrX21oeiwgYm90dGxlbmVjaywgdXRpbHMpCgoKZGVmIG1haW4oKToKICAgIG1vZGVsID0gSVdhcnBNb2RlbCgpCiAgICB0YXJnZXQgPSAxLjUKICAgIHByaW50KGYiPT09IEludGVsIGlXYXJwIEdyZXktQm94IFF1ZXVlaW5nIE1vZGVsID09PSIpCiAgICBmb3Igd2wgaW4gWyJ0eXBpY2FsIiwgImNvbXB1dGUiLCAibWVtb3J5IiwgImNvbnRyb2wiXToKICAgICAgICByID0gbW9kZWwuYW5hbHl6ZSh3bCkKICAgICAgICBlcnIgPSBhYnMoci5jcGkgLSB0YXJnZXQpIC8gdGFyZ2V0ICogMTAwCiAgICAgICAgcyA9ICJQQVNTIiBpZiBlcnIgPCA1IGVsc2UgIk1BUkdJTkFMIiBpZiBlcnIgPCAxNSBlbHNlICJGQUlMIgogICAgICAgIHByaW50KGYiICB7d2w6MTJzfTogQ1BJPXtyLmNwaTouNGZ9ICBJUEM9e3IuaXBjOi40Zn0gIEVycj17ZXJyOi4xZn0lIFt7c31dIikKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK").decode()
w("models/other/iwarp/current/iwarp_validated.py", iwarp_code)
print("  iWarp model written")
